<div class="projet-create-wrapper">
  <h2>Cr√©er un nouveau projet</h2>

  <!-- zone scrollable -->
  <div class="projet-create-body">
    <form
      #f="ngForm"
      (ngSubmit)="submit(f)"
      novalidate
      [attr.aria-busy]="submitting"
    >
      <!-- Titre -->
      <label for="titre">Titre du projet <span aria-hidden="true">*</span></label>
      <input
        id="titre"
        type="text"
        name="titre"
        [(ngModel)]="titre"
        #titreCtrl="ngModel"
        required
        [disabled]="submitting"
        autocomplete="off"
        placeholder="Nom du projet"
      />
      <small class="form-error" *ngIf="titreCtrl.invalid && (titreCtrl.dirty || f.submitted)">
        Le titre est obligatoire.
      </small>

      <!-- Description -->
      <label for="description">Description <span aria-hidden="true">*</span></label>
      <textarea
        id="description"
        name="description"
        [(ngModel)]="description"
        #descCtrl="ngModel"
        rows="4"
        required
        [disabled]="submitting"
        placeholder="D√©crire le projet"
      ></textarea>
      <small class="form-error" *ngIf="descCtrl.invalid && (descCtrl.dirty || f.submitted)">
        La description est obligatoire.
      </small>

      <!-- Dates & Urgent -->
      <div class="form-inline">
        <div>
          <label for="dateDebut">Date d√©but</label>
          <input
            id="dateDebut"
            type="date"
            name="dateDebut"
            [(ngModel)]="dateDebut"
            [disabled]="submitting"
          />
        </div>
        <div>
          <label for="dateFin">Date fin</label>
          <input
            id="dateFin"
            type="date"
            name="dateFin"
            [(ngModel)]="dateFin"
            [disabled]="submitting"
          />
        </div>
        <div class="urgent-check">
          <label for="urgent">
            <input
              id="urgent"
              type="checkbox"
              [(ngModel)]="urgent"
              name="urgent"
              [disabled]="submitting"
            />
            Urgent
          </label>
        </div>
      </div>

      <!-- Lieu -->
      <label>Localisation du projet</label>

      <div class="gps-actions">
        <button type="button" class="btn-gps" (click)="ouvrirMapSelector()" [disabled]="submitting">
          üìç Choisir sur la carte
        </button>
        <span class="gps-help">ou utilisez votre position actuelle</span>
      </div>

      <!-- Modal GPS int√©gr√© -->
      <div class="gps-modal-overlay" *ngIf="showMapSelector" (click)="fermerCarteSelection()">
        <div class="gps-modal-content" (click)="$event.stopPropagation()">

          <!-- Header -->
          <div class="gps-modal-header">
            <div class="gps-header-info">
              <h2><i class="bi bi-pin-map-fill"></i> S√©lectionner la position</h2>
              <p class="gps-instruction">D√©placez la carte pour d√©finir la position du projet</p>
            </div>
            <button class="gps-close-btn" (click)="fermerCarteSelection()" type="button">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>

          <!-- Map Container -->
          <div class="gps-map-container">
            <div id="mapSelector" class="gps-map"></div>

            <!-- CARET CENTR√âE -->
            <div class="map-center-caret">
              <i class="bi bi-cursor-fill"></i>
            </div>

            <!-- Bouton ‚ÄúMe localiser‚Äù -->
            <button class="locate-me-btn" (click)="centrerSurMaPosition()" title="Me localiser">
              <i class="bi bi-crosshair"></i>
            </button>
          </div>

          <!-- Position actuelle affich√©e -->
          <div class="map-position-display" *ngIf="tempLatitude && tempLongitude">
            <div class="position-card">
              <h4><i class="bi bi-cursor-fill"></i> Position s√©lectionn√©e</h4>
              <div class="position-coords">
                <span><strong>Lat:</strong> {{ tempLatitude | number:'1.6-6' }}</span>
                <span><strong>Long:</strong> {{ tempLongitude | number:'1.6-6' }}</span>
              </div>
            </div>
          </div>

          <!-- Actions Footer -->
          <div class="gps-modal-footer">
            <button class="gps-action-btn btn-cancel" (click)="fermerCarteSelection()">
              <i class="bi bi-x-circle-fill"></i> Annuler
            </button>
            <button class="gps-action-btn btn-validate" (click)="validerPosition()"
              [disabled]="!tempLatitude || !tempLongitude">
              <i class="bi bi-check-circle-fill"></i> Valider la position
            </button>
          </div>

        </div>
      </div>

      <!-- Affichage des coordonn√©es choisies -->
      <p class="coords" *ngIf="latitude && longitude">
        ‚úÖ Latitude : {{ latitude }} <br />
        ‚úÖ Longitude : {{ longitude }}
      </p>






      <!-- Image -->
      <label for="image">Image</label>
      <!-- ‚õî plus de 'video/*' -->
      <input
        id="image"
        type="file"
        (change)="onFileSelected($event)"
        accept="image/*"
        [disabled]="submitting"
      />

      <!-- Aper√ßu -->
      <!-- <div *ngIf="mediaPreview" class="media-preview">
        <img *ngIf="isImagePreview" [src]="mediaPreview" alt="Aper√ßu de l‚Äôimage s√©lectionn√©e" />
      </div> -->

      <!-- Erreur globale du formulaire -->
      <div *ngIf="errorMessage" class="form-error" aria-live="polite">
        {{ errorMessage }}
      </div>

      <!-- Actions -->
      <div class="actions">
        <button type="submit" [disabled]="!f.valid || submitting">
          <ng-container *ngIf="!submitting; else loadingTpl">Cr√©er</ng-container>
        </button>

        <button
          type="button"
          class="btn-secondary"
          (click)="onCancel()"
          [disabled]="submitting"
        >
          Annuler
        </button>

        <button
          type="button"
          class="btn-light"
          (click)="reset(f)"
          [disabled]="submitting"
        >
          R√©initialiser
        </button>
      </div>

      <ng-template #loadingTpl>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </ng-template>
    </form>
  </div>
</div>
