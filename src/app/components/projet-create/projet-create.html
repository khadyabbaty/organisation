<div class="projet-create-wrapper">
  <h2>Cr√©er un nouveau projet</h2>

  <!-- zone scrollable -->
  <div class="projet-create-body">
    <form
      #f="ngForm"
      (ngSubmit)="submit(f)"
      novalidate
      [attr.aria-busy]="submitting"
    >

      <!-- ================= TITRE ================= -->
      <label for="titre">Titre du projet <span>*</span></label>
      <input
        id="titre"
        type="text"
        name="titre"
        [(ngModel)]="titre"
        #titreCtrl="ngModel"
        required
        autocomplete="off"
      />
      <small class="form-error" *ngIf="titreCtrl.invalid && (titreCtrl.dirty || f.submitted)">
        Le titre est obligatoire
      </small>

      <!-- ================= DESCRIPTION ================= -->
      <label for="description">Description <span>*</span></label>
      <textarea
        id="description"
        name="description"
        [(ngModel)]="description"
        #descCtrl="ngModel"
        rows="4"
        required
      ></textarea>
      <small class="form-error" *ngIf="descCtrl.invalid && (descCtrl.dirty || f.submitted)">
        La description est obligatoire
      </small>

      <!-- ================= TYPE DE PROJET ================= -->
      <label for="typeActivite">Type de projet <span>*</span></label>
      <select
        id="typeActivite"
        name="typeActivite"
        [(ngModel)]="typeActivite"
        required
      >
        <option *ngFor="let type of typesDisponibles" [value]="type.value">
          {{ type.label }}
        </option>
      </select>

      <!-- ================= CHAMPS CONDITIONNELS ================= -->

      <!-- FINANCEMENT -->
      <div *ngIf="typeActivite === 'FINANCEMENT'">
        <label>Montant √† financer (‚Ç¨)</label>
        <input
          type="number"
          name="montantFinancier"
          [(ngModel)]="montantFinancier"
          min="0"
          step="0.01"
        />
      </div>

      <!-- EVENEMENT -->
      <div *ngIf="typeActivite === 'EVENEMENT'">
        <label>Lieu de l'√©v√©nement</label>
        <input
          type="text"
          name="lieuEvenement"
          [(ngModel)]="lieuEvenement"
        />
      </div>

      <!-- PARRAINAGE -->
      <div *ngIf="typeActivite === 'PARRAINAGE'">
        <label>Nombre de b√©n√©ficiaires</label>
        <input
          type="number"
          name="nombreBeneficiaires"
          [(ngModel)]="nombreBeneficiaires"
          min="1"
        />
      </div>

      <!-- ================= DATES & URGENT ================= -->
      <div class="form-inline">
        <div>
          <label>Date d√©but</label>
          <input type="date" name="dateDebut" [(ngModel)]="dateDebut" />
        </div>
        <div>
          <label>Date fin</label>
          <input type="date" name="dateFin" [(ngModel)]="dateFin" />
        </div>
        <label class="urgent-check">
          <input type="checkbox" name="urgent" [(ngModel)]="urgent" />
          Urgent
        </label>
      </div>

      <!-- ================= LOCALISATION ================= -->
      <label>Localisation du projet</label>
      <button type="button" (click)="ouvrirMapSelector()">üìç Choisir sur la carte</button>

      <p *ngIf="latitude && longitude" class="coords">
        Latitude : {{ latitude }} <br />
        Longitude : {{ longitude }}
      </p>

      <!-- ================= IMAGE ================= -->
      <label>Image</label>
      <input type="file" accept="image/*" (change)="onFileSelected($event)" />

      <!-- ================= ERREUR ================= -->
      <div *ngIf="errorMessage" class="form-error">
        {{ errorMessage }}
      </div>

      <!-- ================= ACTIONS ================= -->
      <div class="actions">
        <button type="submit" [disabled]="!f.valid || submitting">
          Cr√©er
        </button>

        <button type="button" (click)="onCancel()">Annuler</button>
      </div>

    </form>
  </div>
</div>

<!-- ================= MODAL GPS ================= -->
<div class="gps-modal-overlay" *ngIf="showMapSelector" (click)="fermerCarteSelection()">
  <div class="gps-modal-content" (click)="$event.stopPropagation()">

    <div class="gps-modal-header">
      <h3>üìç S√©lectionner la position</h3>
      <button (click)="fermerCarteSelection()">‚úñ</button>
    </div>

    <div id="mapSelector" class="gps-map"></div>

    <div *ngIf="tempLatitude && tempLongitude" class="map-position-display">
      <strong>Lat:</strong> {{ tempLatitude | number:'1.6-6' }} |
      <strong>Long:</strong> {{ tempLongitude | number:'1.6-6' }}
    </div>

    <div class="gps-modal-footer">
      <button (click)="validerPosition()">Valider</button>
    </div>

  </div>
</div>
